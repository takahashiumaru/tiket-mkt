<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tiket MKT</title>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
:root{
  --primary:#2563eb;
  --bg:#f1f5f9;
  --card:#ffffff;
  --border:#e5e7eb;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  padding:24px;
}

.container{max-width:900px;margin:auto}

.card{
  background:var(--card);
  border-radius:14px;
  padding:24px;
  box-shadow:0 10px 25px rgba(0,0,0,.06);
}

h1{margin-bottom:4px}
.subtitle{color:#6b7280;margin-bottom:24px}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
}

label{
  font-size:13px;
  font-weight:600;
  margin-bottom:6px;
  display:block;
}

input,textarea{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:14px;
}

textarea{min-height:90px}

/* ===== CUSTOM COMBOBOX ===== */
.combo{
  position:relative;
}

.combo-display{
  padding:10px 12px;
  border:1px solid var(--border);
  border-radius:10px;
  cursor:pointer;
  background:#fff;
}

.combo-display::after{
  content:"â–¾";
  float:right;
  color:#64748b;
}

.combo-list{
  position:absolute;
  top:110%;
  left:0;
  right:0;
  background:#fff;
  border:1px solid var(--border);
  border-radius:12px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  max-height:220px;
  overflow:auto;
  display:none;
  z-index:20;
}

.combo.open .combo-list{display:block}

.combo-list div{
  padding:12px 14px;
  cursor:pointer;
  font-size:14px;
}

.combo-list div:hover{
  background:#e0e7ff;
}

.combo-list div.active{
  background:var(--primary);
  color:#fff;
}

/* ===== PIC ===== */
.pic-container{display:flex;flex-wrap:wrap;gap:8px}
.pic-item{
  padding:8px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  cursor:pointer;
  font-size:13px;
  background:#fff;
}
.pic-item.active{
  background:var(--primary);
  color:#fff;
  border-color:var(--primary);
}

button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  background:linear-gradient(135deg,#2563eb,#1d4ed8);
  color:#fff;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}

#dropArea{
  border:2px dashed var(--border);
  border-radius:12px;
  padding:20px;
  text-align:center;
  cursor:pointer;
  color:#6b7280;
  margin-top:8px;
}

#dropArea.dragover{
  background:#e0e7ff;
}

#imagePreview{
  max-width:100%;
  border-radius:12px;
  margin-top:8px;
  display:none;
  border:1px solid var(--border);
}

#removeImageBtn{
  display:none;
  margin-top:6px;
  padding:6px 12px;
  border:none;
  background:#ef4444;
  color:#fff;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
}
</style>

<link rel="icon" type="image/png" href="favicon.png">
</head>

<body>
<div class="container">
<div class="card">
<h1>ðŸŽ« Generator Tiket Dev</h1>
<div class="subtitle">Frontend / Backend â†’ Telegram</div>

<div class="grid">

<!-- JENIS TIKET -->
<div>
<label>Jenis Tiket *</label>
<div class="combo" data-target="ticketType">
  <div class="combo-display">Pilih</div>
  <div class="combo-list">
    <div>Backend</div>
    <div>Frontend</div>
    <div>Quality Assurance</div>
  </div>
</div>
<input type="hidden" id="ticketType">
</div>

<!-- KATEGORI -->
<div>
<label>Kategori *</label>
<div class="combo" data-target="category">
  <div class="combo-display">Pilih</div>
  <div class="combo-list">
    <div>New Feature</div>
    <div>Revision Feature</div>
    <div>Cek Data</div>
    <div>Bug</div>
    <div>Error</div>
  </div>
</div>
<input type="hidden" id="category">
</div>

<!-- ACTION -->
<div>
<label>Action *</label>
<div class="combo" data-target="actionType">
  <div class="combo-display">Pilih</div>
  <div class="combo-list">
    <div>View</div><div>Create</div><div>Update</div>
    <div>Delete</div><div>Print Excel</div><div>Print PDF</div>
    <div>CRUD</div>
  </div>
</div>
<input type="hidden" id="actionType">
</div>

<!-- METHOD -->
<div>
<label>HTTP Method *</label>
<div class="combo" data-target="method">
  <div class="combo-display">Pilih</div>
  <div class="combo-list">
    <div>GET</div><div>POST</div><div>PUT</div><div>DELETE</div>
    <div>CRUD</div>
  </div>
</div>
<input type="hidden" id="method">
</div>

<!-- PIC -->
<div>
<label>PIC *</label>
<div class="pic-container">
  <div class="pic-item" data-pic="@arifinabd">Arifin</div>
  <div class="pic-item" data-pic="@Umarxch">Umar</div>
  <div class="pic-item" data-pic="@Rmakie">Pak Ridwan</div>
</div>
</div>

</div>
<br>

<label>Endpoint *</label>
<input id="endpoint">

<label style="margin-top:12px">Parameter *</label>
<textarea id="params"></textarea>
<br>
<label>Deskripsi *</label>
<textarea id="description"></textarea>
<br>
<label>Workflow *</label>
<textarea id="workflow"></textarea>
<br>

<!-- Upload Gambar -->
<label>Upload Gambar (Opsional)</label>
<div id="dropArea">Tarik & lepas gambar di sini atau klik / paste (Ctrl+V)</div>
<input type="file" id="image" accept="image/*" style="display:none">
<img id="imagePreview">
<button id="removeImageBtn">Hapus Gambar</button>
<br><br>

<button onclick="validateAndSend()">ðŸš€ Kirim Tiket</button>
</div>
</div>

<script>
const BOT_TOKEN = "6293769087:AAHgRTAHAJj3yG6KC6dex3iNlYgUQjAJr0o";
const CHAT_ID = "-1003859941008";

/* ==== COMBOBOX LOGIC ==== */
document.querySelectorAll(".combo").forEach(combo=>{
  const display=combo.querySelector(".combo-display");
  const list=combo.querySelector(".combo-list");
  const hidden=document.getElementById(combo.dataset.target);

  display.onclick=()=>combo.classList.toggle("open");

  list.querySelectorAll("div").forEach(item=>{
    item.onclick=()=>{
      display.textContent=item.textContent;
      hidden.value=item.textContent;
      list.querySelectorAll("div").forEach(i=>i.classList.remove("active"));
      item.classList.add("active");
      combo.classList.remove("open");
    };
  });
});

document.addEventListener("click",e=>{
  if(!e.target.closest(".combo"))
    document.querySelectorAll(".combo").forEach(c=>c.classList.remove("open"));
});

/* ==== PIC ==== */
let selectedPics=[];
document.querySelectorAll(".pic-item").forEach(el=>{
  el.onclick=()=>{
    const p=el.dataset.pic;
    el.classList.toggle("active");
    selectedPics.includes(p)
      ? selectedPics=selectedPics.filter(x=>x!==p)
      : selectedPics.push(p);
  };
});

/* ==== IMAGE PREVIEW & REMOVE + DRAG & DROP + PASTE ==== */
const imageInput = document.getElementById("image");
const imagePreview = document.getElementById("imagePreview");
const removeImageBtn = document.getElementById("removeImageBtn");
const dropArea = document.getElementById("dropArea");

// Klik area -> buka file picker
dropArea.addEventListener("click", () => imageInput.click());

// Drag & Drop
dropArea.addEventListener("dragover", e => { e.preventDefault(); dropArea.classList.add("dragover"); });
dropArea.addEventListener("dragleave", e => { e.preventDefault(); dropArea.classList.remove("dragover"); });
dropArea.addEventListener("drop", e => {
  e.preventDefault();
  dropArea.classList.remove("dragover");
  if(e.dataTransfer.files.length){
    imageInput.files = e.dataTransfer.files;
    showImagePreview(e.dataTransfer.files[0]);
  }
});

// Copy-Paste dari clipboard
document.addEventListener("paste", e => {
  const items = e.clipboardData.items;
  for(let i=0;i<items.length;i++){
    if(items[i].type.indexOf("image")!==-1){
      const file = items[i].getAsFile();
      const dt = new DataTransfer();
      dt.items.add(file);
      imageInput.files = dt.files;
      showImagePreview(file);
      break;
    }
  }
});

function showImagePreview(file){
  const reader = new FileReader();
  reader.onload = e => {
    imagePreview.src = e.target.result;
    imagePreview.style.display = "block";
    removeImageBtn.style.display = "inline-block";
  };
  reader.readAsDataURL(file);
}

// Remove image
removeImageBtn.onclick = () => {
  imageInput.value = "";
  imagePreview.src = "";
  imagePreview.style.display = "none";
  removeImageBtn.style.display = "none";
};

/* ==== VALIDATION & TELEGRAM ==== */
function validateAndSend(){
  const req=[ticketType,category,actionType,method,endpoint,params,description,workflow];
  if(req.some(f=>!f.value.trim()))
    return Swal.fire("Oops","Semua field wajib diisi","warning");
  if(!selectedPics.length)
    return Swal.fire("PIC kosong","Pilih minimal 1 PIC","warning");
  sendToTelegram();
}

async function sendToTelegram(){
  Swal.fire({title:"Mengirim tiket...",didOpen:()=>Swal.showLoading()});

  const caption=`
ðŸŽ« *TIKET ${ticketType.value.toUpperCase()}*
*Kategori*: ${category.value}

*PIC*
${selectedPics.join(" ")}

*Action* : ${actionType.value}
*Method* : ${method.value}

*Endpoint*
\`\`\`
${endpoint.value}
\`\`\`

*Parameter*
\`\`\`
${params.value}
\`\`\`

*Deskripsi*
${description.value}

*Workflow*
${workflow.value}
`;

  if(imageInput.files.length){
    const fd=new FormData();
    fd.append("chat_id",CHAT_ID);
    fd.append("photo",imageInput.files[0]);
    fd.append("caption",caption);
    fd.append("parse_mode","Markdown");
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{method:"POST",body:fd});
  }else{
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({chat_id:CHAT_ID,text:caption,parse_mode:"Markdown"})
    });
  }

  Swal.fire("Berhasil ðŸŽ‰","Tiket terkirim","success");
}
</script>
</body>
</html>
