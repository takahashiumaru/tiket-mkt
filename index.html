<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>Tiket MKT</title>
<link rel="icon" type="image/png" href="favicon.png">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
/* =========================
   AUTO THEME SWITCH
   ========================= */

const now = new Date();
const year = now.getFullYear();

/* CNY aktif sampai 29 Februari */
const cnyEnd = new Date(year, 1, 18);

if (now > cnyEnd) {
  document.documentElement.setAttribute("data-theme", "ramadhan");
} else {
  document.documentElement.setAttribute("data-theme", "cny");
}
</script>

<style>
/* =========================
   ROOT THEME
   ========================= */

:root[data-theme="cny"]{
  --primary:#b91c1c;
  --primary-dark:#7f1d1d;
  --accent:#facc15;
  --bg1:#fff7ed;
  --bg2:#fee2e2;
  --border:#e5e7eb;
}

:root[data-theme="ramadhan"]{
  --primary:#065f46;
  --primary-dark:#047857;
  --accent:#facc15;
  --bg1:#ecfdf5;
  --bg2:#d1fae5;
  --border:#d1fae5;
}

/* RESET */
*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:
    radial-gradient(circle at top,var(--bg2) 0%,transparent 40%),
    linear-gradient(180deg,var(--bg1),var(--bg2));
  padding:24px;
  overflow-x:hidden;
}

/* FLOATING DECORATION */
.floating{
  position:fixed;
  top:-120px;
  width:80px;
  height:100px;
  background:linear-gradient(180deg,var(--primary),var(--primary-dark));
  border-radius:40px;
  box-shadow:0 0 25px rgba(0,0,0,.2);
  animation:float 6s ease-in-out infinite;
  z-index:1;
}

.floating::after{
  content:"";
  position:absolute;
  bottom:-14px;
  left:50%;
  width:6px;
  height:14px;
  background:var(--accent);
  transform:translateX(-50%);
}

.floating.left{left:40px}
.floating.right{right:40px;animation-delay:2s}

@keyframes float{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(40px)}
}

/* SPARKLE */
.sparkle{
  position:fixed;
  width:6px;
  height:6px;
  background:var(--accent);
  border-radius:50%;
  top:-10px;
  animation:fall linear forwards;
  z-index:999;
}

@keyframes fall{
  to{
    transform:translateY(110vh);
    opacity:0;
  }
}

/* LAYOUT */
.container{max-width:900px;margin:auto;position:relative;z-index:2}

.card{
  background:#fff;
  border-radius:18px;
  padding:26px;
  box-shadow:0 20px 40px rgba(0,0,0,.12);
  border-top:6px solid var(--primary);
}

h1{
  margin-bottom:6px;
  color:var(--primary-dark);
}

.subtitle{
  color:var(--primary);
  margin-bottom:24px;
  font-weight:500;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
}

label{
  font-size:13px;
  font-weight:600;
  margin-bottom:6px;
  display:block;
  color:var(--primary-dark);
}

input,textarea{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:14px;
}

textarea{min-height:90px}

/* COMBO */
.combo{position:relative}
.combo-display{
  padding:10px 12px;
  border:1px solid var(--border);
  border-radius:10px;
  cursor:pointer;
  background:#fff;
}

:root[data-theme="cny"] .combo-display::after{
  content:"ðŸ§§";
  float:right;
}

:root[data-theme="ramadhan"] .combo-display::after{
  content:"âœ¨";
  float:right;
}

.combo-list{
  position:absolute;
  top:110%;
  left:0;
  right:0;
  background:#fff;
  border:1px solid var(--border);
  border-radius:12px;
  box-shadow:0 12px 30px rgba(0,0,0,.15);
  display:none;
  z-index:20;
}
.combo.open .combo-list{display:block}
.combo-list div{
  padding:12px 14px;
  cursor:pointer;
}
.combo-list div:hover{
  background:var(--bg2);
}
.combo-list div.active{
  background:var(--primary);
  color:#fff;
}

/* PIC */
.pic-container{display:flex;flex-wrap:wrap;gap:8px}
.pic-item{
  padding:8px 16px;
  border-radius:999px;
  border:1px solid var(--border);
  cursor:pointer;
}
.pic-item.active{
  background:var(--primary);
  color:#fff;
  border-color:var(--primary);
}

/* IMAGE */
#dropArea{
  border:2px dashed var(--primary);
  border-radius:14px;
  padding:20px;
  text-align:center;
  cursor:pointer;
  color:var(--primary-dark);
}
#dropArea.dragover{
  background:var(--bg2);
}
#imagePreview{
  max-width:100%;
  border-radius:12px;
  margin-top:8px;
  display:none;
  border:1px solid var(--border);
}
#removeImageBtn{
  display:none;
  margin-top:6px;
  padding:6px 12px;
  border:none;
  background:var(--primary-dark);
  color:#fff;
  border-radius:8px;
  cursor:pointer;
}

/* BUTTON */
button{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:#fff;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
}
button:hover{opacity:.95}

</style>
</head>

<body>

<div class="floating left"></div>
<div class="floating right"></div>

<div class="container">
<div class="card">

<h1 id="mainTitle"></h1>
<div class="subtitle" id="subTitle"></div>

<div class="grid">

<div>
<label>Jenis Tiket *</label>
<div class="combo" data-target="ticketType">
<div class="combo-display">Pilih</div>
<div class="combo-list">
<div>Backend</div>
<div>Frontend</div>
<div>Quality Assurance</div>
</div>
</div>
<input type="hidden" id="ticketType">
</div>

<div>
<label>Kategori *</label>
<div class="combo" data-target="category">
<div class="combo-display">Pilih</div>
<div class="combo-list">
<div>New Feature</div>
<div>Revision Feature</div>
<div>Cek Data</div>
<div>Bug</div>
<div>Error</div>
</div>
</div>
<input type="hidden" id="category">
</div>

<div>
<label>Action *</label>
<div class="combo" data-target="actionType">
<div class="combo-display">Pilih</div>
<div class="combo-list">
<div>View</div><div>Create</div><div>Update</div>
<div>Delete</div><div>Print Excel</div><div>Print PDF</div>
<div>CRUD</div>
</div>
</div>
<input type="hidden" id="actionType">
</div>

<div>
<label>HTTP Method *</label>
<div class="combo" data-target="method">
<div class="combo-display">Pilih</div>
<div class="combo-list">
<div>GET</div><div>POST</div><div>PUT</div><div>DELETE</div>
<div>CRUD</div>
</div>
</div>
<input type="hidden" id="method">
</div>

<div>
<label>PIC *</label>
<div class="pic-container">
<div class="pic-item" data-pic="@arifinabd">Arifin</div>
<div class="pic-item" data-pic="@Umarxch">Umar</div>
<div class="pic-item" data-pic="@Rmakie">Pak Ridwan</div>
</div>
</div>

</div>

<br>

<label>Endpoint *</label>
<input id="endpoint">

<label style="margin-top:12px">Parameter *</label>
<textarea id="params"></textarea>

<br>
<label>Deskripsi *</label>
<textarea id="description"></textarea>

<br>
<label>Workflow *</label>
<textarea id="workflow"></textarea>

<br>
<label>Upload Gambar (Opsional)</label>
<div id="dropArea">Tarik & lepas gambar di sini atau klik / paste (Ctrl+V)</div>
<input type="file" id="image" accept="image/*" style="display:none">
<img id="imagePreview">
<button id="removeImageBtn">Hapus Gambar</button>

<br><br>

<button onclick="validateAndSend()">ðŸš€ Kirim Tiket</button>

</div>
</div>

<script>

/* =========================
   SET TITLE BASED ON THEME
   ========================= */

document.addEventListener("DOMContentLoaded",()=>{
  const theme = document.documentElement.dataset.theme;

  if(theme === "ramadhan"){
    mainTitle.innerHTML = "ðŸŒ™ Generator Tiket Dev";
    subTitle.innerHTML = "Ramadhan Edition âœ¨";
  }else{
    mainTitle.innerHTML = "ðŸ§¨ Generator Tiket Dev";
    subTitle.innerHTML = "Chinese New Year Edition ðŸŽŠ";
  }
});

/* SPARKLE EFFECT */
function launchSparkle(){
  for(let i=0;i<40;i++){
    const s=document.createElement("div");
    s.className="sparkle";
    s.style.left=Math.random()*100+"vw";
    s.style.animationDuration=(Math.random()*2+2)+"s";
    document.body.appendChild(s);
    setTimeout(()=>s.remove(),4000);
  }
}

/* Override Swal Success */
const oldFire = Swal.fire;
Swal.fire = function(...args){
  if(args[0]==="Berhasil ðŸŽ‰") launchSparkle();
  return oldFire.apply(this,args);
};

const BOT_TOKEN = "6293769087:AAHgRTAHAJj3yG6KC6dex3iNlYgUQjAJr0o";
const CHAT_ID = "-1003859941008";

/* COMBO */
document.querySelectorAll(".combo").forEach(combo=>{
  const display=combo.querySelector(".combo-display");
  const list=combo.querySelector(".combo-list");
  const hidden=document.getElementById(combo.dataset.target);

  display.onclick=()=>combo.classList.toggle("open");

  list.querySelectorAll("div").forEach(item=>{
    item.onclick=()=>{
      display.textContent=item.textContent;
      hidden.value=item.textContent;
      list.querySelectorAll("div").forEach(i=>i.classList.remove("active"));
      item.classList.add("active");
      combo.classList.remove("open");
    };
  });
});

document.addEventListener("click",e=>{
  if(!e.target.closest(".combo"))
    document.querySelectorAll(".combo").forEach(c=>c.classList.remove("open"));
});

/* PIC */
let selectedPics=[];
document.querySelectorAll(".pic-item").forEach(el=>{
  el.onclick=()=>{
    const p=el.dataset.pic;
    el.classList.toggle("active");
    selectedPics.includes(p)
      ? selectedPics=selectedPics.filter(x=>x!==p)
      : selectedPics.push(p);
  };
});

/* IMAGE */
const imageInput=document.getElementById("image");
const imagePreview=document.getElementById("imagePreview");
const removeImageBtn=document.getElementById("removeImageBtn");
const dropArea=document.getElementById("dropArea");

dropArea.addEventListener("click",()=>imageInput.click());

dropArea.addEventListener("dragover",e=>{e.preventDefault();dropArea.classList.add("dragover");});
dropArea.addEventListener("dragleave",e=>{e.preventDefault();dropArea.classList.remove("dragover");});
dropArea.addEventListener("drop",e=>{
  e.preventDefault();
  dropArea.classList.remove("dragover");
  if(e.dataTransfer.files.length){
    imageInput.files=e.dataTransfer.files;
    showImagePreview(e.dataTransfer.files[0]);
  }
});

document.addEventListener("paste",e=>{
  const items=e.clipboardData.items;
  for(let i=0;i<items.length;i++){
    if(items[i].type.indexOf("image")!==-1){
      const file=items[i].getAsFile();
      const dt=new DataTransfer();
      dt.items.add(file);
      imageInput.files=dt.files;
      showImagePreview(file);
      break;
    }
  }
});

function showImagePreview(file){
  const reader=new FileReader();
  reader.onload=e=>{
    imagePreview.src=e.target.result;
    imagePreview.style.display="block";
    removeImageBtn.style.display="inline-block";
  };
  reader.readAsDataURL(file);
}

removeImageBtn.onclick=()=>{
  imageInput.value="";
  imagePreview.src="";
  imagePreview.style.display="none";
  removeImageBtn.style.display="none";
};

/* VALIDATION */
function validateAndSend(){
  const req=[ticketType,category,actionType,method,endpoint,params,description,workflow];
  if(req.some(f=>!f.value.trim()))
    return Swal.fire("Oops","Semua field wajib diisi","warning");
  if(!selectedPics.length)
    return Swal.fire("PIC kosong","Pilih minimal 1 PIC","warning");
  sendToTelegram();
}

/* TELEGRAM */
async function sendToTelegram(){
  Swal.fire({title:"Mengirim tiket...",didOpen:()=>Swal.showLoading()});

  const caption=`
ðŸŽ« *TIKET ${ticketType.value.toUpperCase()}*
*Kategori*: ${category.value}

*PIC*
${selectedPics.join(" ")}

*Action* : ${actionType.value}
*Method* : ${method.value}

*Endpoint*
\`\`\`
${endpoint.value}
\`\`\`

*Parameter*
\`\`\`
${params.value}
\`\`\`

*Deskripsi*
${description.value}

*Workflow*
${workflow.value}
`;

  if(imageInput.files.length){
    const fd=new FormData();
    fd.append("chat_id",CHAT_ID);
    fd.append("photo",imageInput.files[0]);
    fd.append("caption",caption);
    fd.append("parse_mode","Markdown");
    await fetch(`https://api.telegram.org/bot6293769087:AAHgRTAHAJj3yG6KC6dex3iNlYgUQjAJr0o/sendPhoto`,{method:"POST",body:fd});
  }else{
    await fetch(`https://api.telegram.org/bot6293769087:AAHgRTAHAJj3yG6KC6dex3iNlYgUQjAJr0o/sendMessage`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({chat_id:CHAT_ID,text:caption,parse_mode:"Markdown"})
    });
  }

  Swal.fire("Berhasil ðŸŽ‰","Tiket terkirim","success");
}

</script>

</body>
</html>
